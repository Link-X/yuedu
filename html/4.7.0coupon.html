<html><head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name="format-detection" content="telephone=no">
		<meta name="full-screen" content="yes">
		<meta name="browsermode" content="application">
		<meta name="x5-orientation" content="portrait">
		<meta name="x5-fullscreen" content="true">
		<meta name="x5-page-mode" content="app">
		<title>
							我的优惠券 - 阅读app
		</title>
		<script src="../style/jquery.min.js"></script>
		<script src="../style/swiper.3.1.7.min.js"></script>
		<link rel="stylesheet" href="../style/weui.min.css">
		<link rel="stylesheet" href="../style/font-awesome.min.css">
		<link rel="stylesheet" href="../style/index.css">

<script src="../style/jweixin-1.3.2.js"></script>
<script type="text/javascript">
	window.sysinfo = window.sysinfo || {"uniacid":2,"acid":"2","siteroot":"http:\/\/shop.itischinese.com\/","siteurl":"http:\/\/shop.itischinese.com\/app\/index.php?i=2&c=entry&do=coupon&m=fy_lessonv2","attachurl":"http:\/\/shop.itischinese.com\/attachment\/","cookie":{"pre":"6114_"},"openid":"om1HxvvE-OW8NE4ZaVUpQn-MGqWI","MODULE_URL":"http:\/\/shop.itischinese.com\/addons\/fy_lessonv2\/"} || {};

	// jssdk config 对象
	jssdkconfig = {"appId":"wx4a922ba228b745ac","nonceStr":"YjIF6ZLSDb4L2Liv","timestamp":"1547892194","signature":"1c18e13d6e4bc2dfbfa38541428a90128622efe5"} || {};

	// 是否启用调试
	jssdkconfig.debug = false;

	jssdkconfig.jsApiList = [
		'checkJsApi',
		'onMenuShareTimeline',
		'onMenuShareAppMessage',
		'onMenuShareQQ',
		'onMenuShareWeibo',
		'hideMenuItems',
		'showMenuItems',
		'hideAllNonBaseMenuItem',
		'showAllNonBaseMenuItem',
		'translateVoice',
		'startRecord',
		'stopRecord',
		'onRecordEnd',
		'playVoice',
		'pauseVoice',
		'stopVoice',
		'uploadVoice',
		'downloadVoice',
		'chooseImage',
		'previewImage',
		'uploadImage',
		'downloadImage',
		'getNetworkType',
		'openLocation',
		'getLocation',
		'hideOptionMenu',
		'showOptionMenu',
		'closeWindow',
		'scanQRCode',
		'chooseWXPay',
		'openProductSpecificView',
		'addCard',
		'chooseCard',
		'openCard'
	];

	wx.config(jssdkconfig);

</script>
<script type="text/javascript">
		wx.ready(function(){
			var shareData = {
				title: "我的优惠券",
				desc: "",
				link: "http://shop.itischinese.com/app/index.php?i=2&c=entry&do=coupon&m=fy_lessonv2&uid=3",
				imgUrl: "http://shop.itischinese.com/attachment/",
				trigger: function (res) {},
				complete: function (res) {},
				success: function (res) {},
				cancel: function (res) {},
				fail: function (res) {}
			};
			wx.onMenuShareTimeline(shareData);
			wx.onMenuShareAppMessage(shareData);
			wx.onMenuShareQQ(shareData);
			wx.onMenuShareWeibo(shareData);
			wx.onMenuShareQZone(shareData);
		});
		</script>
	</head>
	<body>
		<div class="tabbar tabbar_wrap page_wrap">
			<div class="weui_tab">
<link href="../style/coupon.css" rel="stylesheet">
<style type="text/css">
.tabbar_wrap {
	-webkit-overflow-scrolling: unset;
}
</style>
<div class="header-2 cbox" id="header">
	<a href="" class="ico go-back"></a>
	<div class="flex title">我的优惠券</div>
</div>

<div id="loading" style="position: fixed; top: 0px; left: 0px; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); z-index: 100000000; display: none;"><div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div></div>

<!-- 顶部导航  -->
<ul class="tab_wrap">
	<li class="tab_item tab_item_on">
		<a href="./index.php?i=2&amp;c=entry&amp;status=0&amp;do=coupon&amp;m=fy_lessonv2">未使用</a>
	</li>
	<li class="tab_item ">
		<a href="./index.php?i=2&amp;c=entry&amp;status=1&amp;do=coupon&amp;m=fy_lessonv2">已使用</a>
	</li>
	<li class="tab_item ">
		<a href="./index.php?i=2&amp;c=entry&amp;status=-1&amp;do=coupon&amp;m=fy_lessonv2">已过期</a>
	</li>
</ul>
<!-- /顶部导航  -->

<div class="aui-tab-search-box">
	<form method="post" action="./index.php?i=2&amp;c=entry&amp;op=addCoupon&amp;do=coupon&amp;m=fy_lessonv2" onsubmit="return checknum();">
		<div class="aui-tab-search-bg">
			<input type="text" name="card_password" id="card_password" class="cart-input" placeholder="请输入课程优惠码">
			<input type="submit" name="submit" class="submit-btn" value="转换">
		</div>
	</form>
</div>

<div class="my_empty" style="height:40%;">
	<div class="empty_bd  my_course_empty">
		<h3>没有找到任何优惠券~</h3>
	</div>
</div>
<div class="more-pepper" id="getcoupon" onclick=""><a href="">更多好券，去兑换中心看看 <i class="fa fa-long-arrow-right"></i></a></div>

<div id="loading_div" class="loading_div"><div class="loading_bd" style="height:17px;">没有了，已经到底啦</div></div>

<script type="text/javascript">
function GetQueryString(name) {
	var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
	var r = window.location.search.substr(1).match(reg);
	if(r != null) return unescape(r[2]);
	return null;
}

var status = GetQueryString('status');
var ajaxurl   = "./index.php?i=2&c=entry&do=coupon&m=fy_lessonv2";
var loading = document.getElementById("loading");
$(function () {
    var nowPage = 1; //设置当前页数，全局变量
    function getData(page) {
        nowPage++; //页码自动增加，保证下次调用时为新的一页。
        $.get(ajaxurl, {page: page, status:status}, function (data) {
            if (data.length > 0) {
            	loading.style.display = 'none';
                var jsonObj = JSON.parse(data);
                insertDiv(jsonObj);
            }
        });

    }
    //初始化加载第一页数据
    getData(1);

    //生成数据html,append到div中
    function insertDiv(result) {
        var mainDiv =$(".pepper-w");
        var chtml = '';
        for (var j = 0; j < result.length; j++) {
            chtml += '<div class="pepper '+ result[j].classname +'">';
            chtml += '	 <div class="pepper-l">';
			chtml += '		<p class="pepper-l-num">';
			chtml += '			<span> ¥'+ result[j].amount +'</span>';
			chtml += '		</p>';
			chtml += '		<p class="pepper-l-con">使用条件：课程金额满'+ result[j].conditions +'元，' +result[j].category_name+ '可使用</p>';
			chtml += '	</div>';
			chtml += '	<div class="pepper-r">';
			chtml += '		<span>课程券</span>';
			if(result[j].status==0){
				chtml += '		<a href=" ' + result[j].url + '" class="use-now">立即使用</a>';
				chtml += '		<div>有效期至<br/>'+ result[j].endDate +' '+ result[j].endTime +'</div>';
			}
			chtml += '	</div>';
			chtml += '</div>';
			if(result[j].classname=='pepper-red'){
				chtml += '<div class="pepper-b">';
				chtml += '	<div class="pb-con">获取途径：' +result[j].source_name+ '</div>';
				chtml += '	<div class="pb-border"></div>';
				chtml += '</div>';
			}else{
				chtml += '<div class="pepper-b">';
				chtml += '	<div class="pb-con" style="background:#949393;">获取途径：' +result[j].source_name+ '</div>';
				chtml += '</div>';
			}
        }
		mainDiv.append(chtml);
		if(result.length==0){
			document.getElementById("loading_div").innerHTML='<div class="loading_bd" style="height:17px;">没有了，已经到底啦</div>';
		}
    }

    //==============核心代码=============
    var winH = $(window).height(); //页面可视区域高度

    var scrollHandler = function () {
        var pageH = $(document.body).height();
        var scrollT = $(window).scrollTop(); //滚动条top
        var aa = (pageH - winH - scrollT) / winH;
        if (aa < 0.02) {
            if (nowPage % 1 === 0) {
                getData(nowPage);
                $(window).unbind('scroll');
                $("#btn_Page").show();
            } else {
                getData(nowPage);
                $("#btn_Page").hide();
            }
        }
    }
    //定义鼠标滚动事件
    $(window).scroll(scrollHandler);
    //继续加载按钮事件
    $("#btn_Page").click(function () {
    	loading.style.display = 'block';
        getData(nowPage);
        $(window).scroll(scrollHandler);
    });

});
</script>

<script type="text/javascript">
function checknum(){
	var card_password = $("#card_password").val();
	if(card_password==''){
		alert("请输入课程优惠码");
		return false;
	}
	loading.style.display = 'block';
}
</script>


<footer>
    <a href="">阅读app</a>
</footer>

		<!-- 底部导航 -->
		<!-- <div class="weui_tabbar ">

			<a href="./index.html" class="weui_tabbar_item ">
				<div class="weui_tabbar_icon">
					<i class="fa fa-home menu_on" style="font-size: 24px;"></i>
				</div>
				<p class="weui_tabbar_label">首 页</p>
			</a>

			<a href="./search.html" class="weui_tabbar_item ">
				<div class="weui_tabbar_icon">
					<i class="fa fa-video-camera"></i>
				</div>
				<p class="weui_tabbar_label">全部课程</p>
			</a>


			<a href="./mylesson.html" class="weui_tabbar_item ">
				<div class="weui_tabbar_icon">
					<i class="fa fa-book"></i>
				</div>
				<p class="weui_tabbar_label">我的课程</p>
			</a>

			<a href="./self.html" class="weui_tabbar_item ">
				<div class="weui_tabbar_icon">
					<i class="fa fa-user"></i>
				</div>
				<p class="weui_tabbar_label">个人中心</p>
			</a>
		</div> -->
		<!-- /底部导航 -->
	</div>
</div>

<script>
	//动画效果
	var mySwiper = new Swiper('.swiper-container', {
		pagination: '.swiper-pagination',
		/*分页器焦点*/
		effect: 'coverflow',
		/*动画过渡效果*/
		paginationClickable: true,
		/*添加点击效果*/
		centeredSlides: true,
		/*活动内容居中*/
		autoplay: 5000,
		/*自动滑动时间*/
		autoplayDisableOnInteraction: false,
		/*用户操作动画，3s后可以继续执行动画*/
		preloadImages: false,
		lazyLoading: true
	});
	//   分类为两个时的样式
	var $gridNum = $('.grid_wrap .grid_item')
	if($gridNum.length == 2) {
		$gridNum.first().css('border-right', '1px solid #f1f1f5')
	}
	//课程为奇数时图片平铺
	$('.course_main').each(function() {
		var $item = $(this).find(' .course_item');
		var itemNum = $item.length % 2;
		if(itemNum == 1 && $(this).hasClass('course_live')) {
			var $firstitem = $item.first(),
				$img = $firstitem.find("img");
			$firstitem.css('width', "100%");
			var wd = $firstitem.width() || window.innerWidth - 20;
			var boxh = Math.ceil(wd / 2);
			$img.wrap("<div class='big-box' style='height:" + boxh + "px'></div>");
		} else if(itemNum == 1 && $(this).hasClass('course_other')) {
			var $lastitem = $item.last(),
				$img = $lastitem.find("img");
			$lastitem.css('width', "100%");
			var wd = $lastitem.width() || window.innerWidth - 20;
			var boxh = Math.ceil(wd / 2);
			$img.wrap("<div class='big-box' style='height:" + boxh + "px'></div>");
		}
	});
</script>
<div style="display:none;">
	</div>
</body>
<script type="text/javascript">
  apiready = function() {
    api.setStatusBarStyle({
      style: 'light',
      color: '#FBFBFC'
    });
    };
  $(function(){
      var h = $(window).height();
      $("body").height(h);
    })
		$("#header a").on('click',function(){
			api.closeWin({
							name:'coupon'
						});
		})
		$("#getcoupon").on('click',function(){
	    api.openWin({
	            name: 'getcoupon',
	            url: '4.7.1getcoupon.html'
	          });
	  })
</script>
</html>
